{"componentChunkName":"component---src-templates-blog-post-js","path":"/using-asynchronous-function-when-voting-using-steem-js","result":{"data":{"site":{"siteMetadata":{"title":"My Hive Posts"}},"hiveArticle":{"title":"Using Asynchronous Function when Voting using Steem.js","body":"This tutorial is for solving few issues encountered while using Steem.js.\n\nWhile working on a simple [Discord Upvote Bot](https://github.com/codingdefined/DiscordUpvoteBot) I found out that I am getting a lot of Promise Rejection error as well as WebSocket Error and my bot is crashing every time\n\nFor Example :\n```\nUnhandledPromiseRejectionWarning: Unhandled promise rejection(rejection id: 1): Error:Bad Request\n[DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, \npromise rejections that are not handled will terminate the Node.js process with a non-zero exit code.\n```\n\nAnd\n\n```\nUnhandled rejection Error: not opened\nat WebSocket.send (/app/node_modules/ws/lib/WebSocket.js:344:18)\n at /app/node_modules/steem/lib/api/transports/ws.js:135:19\n at tryCatcher (/app/node_modules/bluebird/js/release/util.js:16:23)\nat Promise._settlePromiseFromHandler (/app/node_modules/bluebird/js/release/promise.js:512:31)\nat Promise._settlePromise (/app/node_modules/bluebird/js/release/promise.js:569:18)\nat Promise._settlePromiseCtx (/app/node_modules/bluebird/js/release/promise.js:606:10)\n```\n\nSo, to fix the first error **UnhandledPromiseRejectionWarning**, which means is caused by the failed assertion. Since we do not have any control on the inner workings of Steem. The best thing for this is to catch the exception as a promise. So to do that you need to use the Asynchrnous function of the vote i.e. `steem.broadcast.voteAsync()` and then use the catch function to catch any error as shown below\n\n```\nsteem.broadcast.voteAsync(\n      process.env.STEEMKEY,\n      process.env.STEEMAUTHOR,\n      author,\n      permalink,\n      weightPercentage,\n      function(err, result) {\n        // Inner Workings  \n      }).catch(function() {\n          //Error Catching\n      });\n```\n\nAfter doing this, I does not see any **UnhandledPromiseRejectionWarning**.\n\nFor Unhandled rejection Error: not opened error we need to add the URL of the steem api by using setOptions, because Steem npm package uses web socket and instead we need to use the Steemit API.\n\n```\nsteem.api.setOptions({url: 'https://api.steemit.com'});\n```\n\nThese are few of the errors encountered and now the Discord Upvote Bot is ready to be used in all the servers.\n\n\n<br /><hr/><em>Posted on <a href=\"https://utopian.io/utopian-io/@codingdefined/using-asynchronous-function-when-voting-using-steem-js\">Utopian.io -  Rewarding Open Source Contributors</a></em><hr/>","created":"December 07, 2017"}},"pageContext":{"title":"Using Asynchronous Function when Voting using Steem.js","permlink":"using-asynchronous-function-when-voting-using-steem-js","previous":{"title":"Colourfulphotography - A Big Christmas Tree","permlink":"colourfulphotography-a-big-christmas-tree"},"next":{"title":"On the Way to Temple near Nandi Hills","permlink":"on-the-way-to-temple-near-nandi-hills"}}}}